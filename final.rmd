---
title: "\\vspace{-2cm} Stat 405 Final"
author: "Meera Borle, Isis Burgos, Naomi Consiglio, Carson Foster, Aidan Gerber"
date: "December 10th, 2022"
fontsize: 12pt
geometry: margin=1in
mainfont: Times New Roman
colorlinks: yes
output:
  pdf_document:
    default
  prettydoc::html_pretty:
    toc: yes
    toc_depth: 3
    theme: hpstr
    highlight: tango
    df_print: paged
  html_document:
    toc: yes
    toc_depth: '3'
    df_print: paged
header-includes: \usepackage{setspace}
---
\doublespacing
```{r setup, include=FALSE}
options(scipen = 999)
options(digits = 2)
# for PDF full
# knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, dev = 'png')
# SHOW_BACK_TO_TOP=FALSE
# for PDF no code
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, dev = "png", results = "hide", out.width = "100%", fig.align = "center", dpi = 300)
SHOW_BACK_TO_TOP <- FALSE
# for html with svg
# knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, dev = 'svglite', out.width="100%")
# SHOW_BACK_TO_TOP=TRUE
```

```{r imports}
library(tidyverse)
library(RSQLite)
```

```{r include-db, include = FALSE}
db <- dbConnect(SQLite(), "data/mortality.sqlite")
query <- function(q) {
    req <- dbSendQuery(db, q)
    results <- dbFetch(req)
    dbClearResult(req)
    results
}
```
# Introduction
Our main dataset is a mortality dataset from the National Bureau of Economic Research. There are new versions of it each year and we are using the 2019 version. Each row is one death based on information filed in death certificates in the 50 states plus Washington DC. Columns are factors regarding the status of persons involved in deaths that can be gleaned from public death certificates. The dataset is focused on the different causes of death. Notable information the dataset contains is education, sex, age classification, day of month, place of death, weekday, manner of death, cause of death, and different risk factors that the deceased had.

# Questions
We are interested in what different factors correlated with higher death rates based on cause of death, age groups, and weekdays.

# Exploration
## Deaths by Weekday
First, we plotted weekday of death versus death counts. There were the most deaths on Tuesday. However, days have an average of `r query("SELECT count(*) FROM mortality")$count / 365` deaths and 2019 had an extra Tuesday so adjusting for that, the most deaths were on Fridays.

```{r plot_weekday_deaths}
source("plots/weekday_deaths.r", local = TRUE, print.eval = TRUE)
```

## Deaths by Age
Next, we plotted age versus death counts. Deaths were most prevalent among larger age groups such as those between 70 and 84, although deaths start increasing more quickly at age 60. There is also a spike in those less than 1 day old. However, those greater than 1 day old do not frequently die.

```{r plot_age_deaths, fig.height = 11, fig.width = 8}
source("plots/age_deaths.r", local = TRUE, print.eval = TRUE)
```

## Deaths by Manner
```{r plot_age_manner, fig.height = 11, fig.width = 8}
source("plots/age_manner.r", local = TRUE, print.eval = TRUE)
```

## Deaths by Age and Gender
```{r plot_age_gender, fig.height = 11, fig.width = 8}
source("plots/age_gender.r", local = TRUE, print.eval = TRUE)
```


```{r disconnect-db, include = FALSE}
dbDisconnect(db)
```